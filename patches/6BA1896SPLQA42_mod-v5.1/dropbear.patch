--- a/etc/init.d/dropbear	2021-09-17 21:30:49.000000000 -0500
+++ b/etc/init.d/dropbear	2023-02-06 05:59:56.000000000 -0600
@@ -42,7 +42,7 @@
 		'RootPasswordAuth:bool:1' \
 		'RootLogin:bool:1' \
 		'rsakeyfile:file' \
-		'dsskeyfile:file' \
+		'ecdsakeyfile:file' \
 		'BannerFile:file' \
 		'Port:list(port):22' \
 		'SSHKeepAlive:uinteger:300' \
@@ -53,7 +53,7 @@
 {
 	local PasswordAuth enable Interface GatewayPorts \
 		RootPasswordAuth RootLogin rsakeyfile \
-		dsskeyfile BannerFile Port SSHKeepAlive IdleTimeout
+		ecdsakey BannerFile Port SSHKeepAlive IdleTimeout
 
 	validate_section_dropbear "${1}" || {
 		echo "validation failed"
@@ -71,18 +71,19 @@
 	[ "${RootPasswordAuth}" -eq 0 ] && procd_append_param command -g
 	[ "${RootLogin}" -eq 0 ] && procd_append_param command -w
 	[ -n "${rsakeyfile}" ] && procd_append_param command -r "${rsakeyfile}"
-	[ -n "${dsskeyfile}" ] && procd_append_param command -d "${dsskeyfile}"
+	[ -n "${ecdsakeyfile}" ] && procd_append_param command -r "${ecdsakeyfile}"
 	[ -n "${BannerFile}" ] && procd_append_param command -b "${BannerFile}"
 	[ -n "${Interface}" ] && network_get_device Interface "${Interface}"
 	append_ports "${Interface}" "${Port}"
 	[ "${IdleTimeout}" -ne 0 ] && procd_append_param command -I "${IdleTimeout}"
 	[ "${SSHKeepAlive}" -ne 0 ] && procd_append_param command -K "${SSHKeepAlive}"
+	procd_set_param respawn
 	procd_close_instance
 }
 
 keygen()
 {
-	for keytype in rsa dss; do
+	for keytype in rsa; do
 		# check for keys
 		key=dropbear/dropbear_${keytype}_host_key
 		[ -f /tmp/$key -o -s /etc/$key ] || {
@@ -95,18 +96,31 @@
 		}
 	done
 
+	for keytype in ecdsa; do
+		# check for keys
+		key=dropbear/dropbear_${keytype}_host_key
+		[ -f /tmp/$key -o -s /etc/$key ] || {
+			# generate missing keys
+			mkdir -p /tmp/dropbear
+			[ -x /usr/bin/dropbearkey ] && {
+				/usr/bin/dropbearkey -t $keytype -s 521 -f /tmp/$key 2>&- >&- && exec /etc/rc.common "$initscript" start
+			} &
+		exit 0
+		}
+	done
+
 	lock /tmp/.switch2jffs
 	mkdir -p /etc/dropbear
 	mv /tmp/dropbear/dropbear_* /etc/dropbear/
 	lock -u /tmp/.switch2jffs
-	#chown root /etc/dropbear
-	#chmod 0700 /etc/dropbear
+	chown root /etc/dropbear
+	chmod 0700 /etc/dropbear
 }
 
 start_service()
 {
 	[ -s /etc/dropbear/dropbear_rsa_host_key -a \
-	  -s /etc/dropbear/dropbear_dss_host_key ] || keygen
+	-s /etc/dropbear/dropbear_ecdsa_host_key ] || keygen
 
 	. /lib/functions.sh
 	. /lib/functions/network.sh
@@ -117,7 +131,13 @@
 
 service_triggers()
 {
-	procd_add_reload_trigger "dropbear"
+	procd_open_trigger
+	procd_add_config_trigger "config.change" "dropbear" /etc/init.d/dropbear reload
+
+	config_load "${NAME}"
+
+	procd_close_trigger
+
 	procd_add_validation validate_section_dropbear
 }
 
diff -ru a/etc/init.d/omcid.sh b/etc/init.d/omcid.sh
